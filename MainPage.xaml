<?xml version="1.0" encoding="utf-8" ?>
<ContentPage x:Class="SkinMonitor.MainPage"
             x:Name="PageRoot"
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:SkinMonitor.ViewModels"
             xmlns:models="clr-namespace:SkinMonitor.Models"
             xmlns:controls="clr-namespace:SkinMonitor.Views"
             x:DataType="viewmodels:MainPageViewModel"
             Title="{Binding Title}"
             BackgroundColor="White">

    <Grid RowDefinitions="Auto,*,Auto">
        <!-- Header -->
        <Border Grid.Row="0" 
                BackgroundColor="#512BD4" 
                Padding="20,10"
                StrokeThickness="0">
            <Border.Shadow>
                <Shadow Brush="Black" Opacity="0.3" Radius="5" Offset="0,2" />
            </Border.Shadow>
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                
                <!-- Header TEXT bound to MainPageViewModel properties -->
                <VerticalStackLayout Grid.Column="0" VerticalOptions="Center">
                    <Label Text="Wound Healing Tracker 0.0.1" 
                           FontSize="24" FontAttributes="Bold" 
                           TextColor="White" />
                    <Label Text="{Binding ActiveWounds.Count, StringFormat='{0} active wounds'}" 
                           FontSize="14" 
                           TextColor="White" />
                </VerticalStackLayout>
            </Grid>
        </Border>

        <!-- Main Content -->
        <RefreshView Grid.Row="1" 
                     Command="{Binding RefreshCommand}" 
                     IsRefreshing="{Binding IsBusy}">

            <ScrollView>
                <VerticalStackLayout Padding="20" Spacing="20">
                    <!-- Add Wound button -->
                    <Border>
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="20" />
                        </Border.StrokeShape>
                        <Border.Shadow>
                            <Shadow Brush="Black" Opacity="0.25" Radius="40" Offset="0,4"/>
                        </Border.Shadow>
                        <Button 
                            Text="Add Wound" 
                            Command="{Binding AddWoundCommand}"
                            BackgroundColor="White"
                            TextColor="#512BD4"
                            CornerRadius="20"
                            Padding="12" />         
                    </Border>
                    
                    <!-- Active Wounds Section -->
                    <Border BackgroundColor="White"
                            StrokeThickness="0"
                            Padding="15">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="10" />
                        </Border.StrokeShape>
                        <Border.Shadow>
                            <Shadow Brush="Black" Opacity="0.2" Radius="8" Offset="0,2" />
                        </Border.Shadow>

                        <VerticalStackLayout>
                            <Label Text="Active Wounds" 
                                   FontSize="18" FontAttributes="Bold" 
                                   TextColor="#212121" />

                            <CollectionView ItemsSource="{Binding ActiveWounds}"
                                          EmptyView="No active wounds"
                                          Margin="0,10,0,0">
                                <CollectionView.ItemTemplate>
                                    <DataTemplate x:DataType="models:Wound">
                                        <Grid Padding="10">
                                            <Grid.GestureRecognizers>
                                                <TapGestureRecognizer Command="{Binding BindingContext.SelectWoundCommand, Source={x:Reference Name=PageRoot}}"
                                                                      CommandParameter="{Binding .}" />
                                            </Grid.GestureRecognizers>

                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="60" />
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="Auto" />
                                            </Grid.ColumnDefinitions>

                                            <!-- Wound Icon/Thumbnail -->
                                            <Border Grid.Column="0" 
                                                    BackgroundColor="#512BD4"
                                                    WidthRequest="50" 
                                                    HeightRequest="50"
                                                    StrokeThickness="0">
                                                <Border.StrokeShape>
                                                    <RoundRectangle CornerRadius="25" />
                                                </Border.StrokeShape>
                                                <Label Text="🩹" 
                                                       FontSize="24" 
                                                       HorizontalOptions="Center" 
                                                       VerticalOptions="Center" />
                                            </Border>

                                            <!-- Wound Info -->
                                            <VerticalStackLayout Grid.Column="1" 
                                                                 VerticalOptions="Center" 
                                                                 Margin="15,0,0,0">
                                                <Label Text="{Binding Name}" 
                                                       FontSize="16" 
                                                       FontAttributes="Bold"
                                                       TextColor="#212121" />
                                                <Label Text="{Binding BodyLocation}" 
                                                       FontSize="14" 
                                                       TextColor="#757575" />
                                                <Label Text="{Binding DateCreated, StringFormat='Created: {0:MMM dd, yyyy}'}" 
                                                       FontSize="12" 
                                                       TextColor="#757575" />
                                            </VerticalStackLayout>

                                            <!-- Status Indicator -->
                                            <Border Grid.Column="2" 
                                                    BackgroundColor="#4CAF50"
                                                    Padding="8,4" 
                                                    VerticalOptions="Center"
                                                    StrokeThickness="0">
                                                <Border.StrokeShape>
                                                    <RoundRectangle CornerRadius="10" />
                                                </Border.StrokeShape>
                                                <Label Text="{Binding Type}" 
                                                       FontSize="12" 
                                                       TextColor="White" />
                                            </Border>
                                        </Grid>
                                    </DataTemplate>
                                </CollectionView.ItemTemplate>
                            </CollectionView>
                        </VerticalStackLayout>
                    </Border>

                    <!-- All Wounds Section -->
                    <Border BackgroundColor="White"
                            StrokeThickness="0"
                            Padding="15">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="10" />
                        </Border.StrokeShape>
                        <Border.Shadow>
                            <Shadow Brush="Black" Opacity="0.2" Radius="8" Offset="0,2" />
                        </Border.Shadow>

                        <VerticalStackLayout>
                            <Label Text="All Wounds" 
                                   FontSize="18" FontAttributes="Bold" 
                                   TextColor="#212121" />

                            <CollectionView ItemsSource="{Binding Wounds}"
                                          EmptyView="No wounds recorded"
                                          Margin="0,10,0,0">
                                <CollectionView.ItemTemplate>
                                    <DataTemplate x:DataType="models:Wound">
                                        <Grid Padding="10">
                                            <Grid.GestureRecognizers>
                                                <TapGestureRecognizer Command="{Binding BindingContext.SelectWoundCommand, Source={x:Reference Name=PageRoot}}"
                                                                      CommandParameter="{Binding .}" />
                                            </Grid.GestureRecognizers>

                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="40" />
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="Auto" />
                                            </Grid.ColumnDefinitions>

                                            <!-- Status Dot -->
                                            <Ellipse Grid.Column="0"
                                                     Fill="#4CAF50"
                                                     WidthRequest="12" 
                                                     HeightRequest="12" 
                                                     VerticalOptions="Center" />

                                            <!-- Wound Info -->
                                            <VerticalStackLayout Grid.Column="1" 
                                                                 VerticalOptions="Center" 
                                                                 Margin="10,0,0,0">
                                                <Label Text="{Binding Name}" 
                                                       FontSize="14"
                                                       TextColor="#212121" />
                                                <Label Text="{Binding BodyLocation}" 
                                                       FontSize="12" 
                                                       TextColor="#757575" />
                                            </VerticalStackLayout>

                                            <!-- Date -->
                                            <Label Grid.Column="2" 
                                                   Text="{Binding DateCreated, StringFormat='{0:MMM dd}'}" 
                                                   FontSize="12" 
                                                   TextColor="#757575"
                                                   VerticalOptions="Center" />
                                        </Grid>
                                    </DataTemplate>
                                </CollectionView.ItemTemplate>
                            </CollectionView>
                        </VerticalStackLayout>
                    </Border>

                </VerticalStackLayout>
            </ScrollView>
        </RefreshView>

        <!-- Loading Indicator -->
        <ActivityIndicator Grid.Row="1" 
                         IsVisible="{Binding IsBusy}" 
                         IsRunning="{Binding IsBusy}"
                         VerticalOptions="Center"
                         HorizontalOptions="Center"
                         Color="#512BD4" />

        <!-- Bottom Navigation Bar -->
        <controls:NavigationBar Grid.Row="2" BindingContext="{Binding NavigationViewModel}" />

    </Grid>
</ContentPage>
