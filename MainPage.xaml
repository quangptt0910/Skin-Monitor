<?xml version="1.0" encoding="utf-8" ?>
<ContentPage x:Class="SkinMonitor.MainPage"
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:SkinMonitor.ViewModels"
             xmlns:models="clr-namespace:SkinMonitor.Models"
             x:DataType="viewmodels:WoundListViewModel"
             Title="{Binding Title}">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Header -->
        <Frame Grid.Row="0" BackgroundColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}" 
               HasShadow="True" Padding="20,10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                
                <StackLayout Grid.Column="0" VerticalOptions="Center">
                    <Label Text="Wound Healing Tracker" 
                           FontSize="24" FontAttributes="Bold" 
                           TextColor="White" />
                    <Label Text="{Binding ActiveWounds.Count, StringFormat='{0} active wounds'}" 
                           FontSize="14" 
                           TextColor="White" />
                </StackLayout>
                
                <Button Grid.Column="1" 
                        Text="Add Wound" 
                        Command="{Binding AddWoundCommand}"
                        BackgroundColor="White"
                        TextColor="{StaticResource Primary}"
                        CornerRadius="20"
                        Padding="15,8" />
            </Grid>
        </Frame>

        <!-- Main Content -->
        <RefreshView Grid.Row="1" 
                     Command="{Binding RefreshCommand}" 
                     IsRefreshing="{Binding IsBusy}">
            
            <ScrollView>
                <StackLayout Padding="20" Spacing="20">
                    
                    <!-- Active Wounds Section -->
                    <Frame BackgroundColor="{AppThemeBinding Light=White, Dark={StaticResource Gray900}}"
                           HasShadow="True" CornerRadius="10" Padding="15">
                        <StackLayout>
                            <Label Text="Active Wounds" 
                                   FontSize="18" FontAttributes="Bold" 
                                   TextColor="{AppThemeBinding Light={StaticResource Gray900}, Dark=White}" />
                            
                            <CollectionView ItemsSource="{Binding ActiveWounds}"
                                          EmptyView="No active wounds">
                                <CollectionView.ItemTemplate>
                                    <DataTemplate>
                                        <Grid Padding="10" x:DataType="models:Wound">
                                            <Grid.GestureRecognizers>
                                                <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:WoundListViewModel}}, Path=SelectWoundCommand}"
                                                                    CommandParameter="{Binding .}" />
                                            </Grid.GestureRecognizers>
                                            
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="60" />
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="Auto" />
                                            </Grid.ColumnDefinitions>
                                            
                                            <!-- Wound Icon/Thumbnail -->
                                            <Frame Grid.Column="0" 
                                                   BackgroundColor="{StaticResource Primary}"
                                                   CornerRadius="30" 
                                                   Padding="0" 
                                                   WidthRequest="50" 
                                                   HeightRequest="50">
                                                <Label Text="ðŸ©¹" 
                                                       FontSize="24" 
                                                       HorizontalOptions="Center" 
                                                       VerticalOptions="Center" />
                                            </Frame>
                                            
                                            <!-- Wound Info -->
                                            <StackLayout Grid.Column="1" 
                                                       VerticalOptions="Center" 
                                                       Margin="15,0,0,0">
                                                <Label Text="{Binding Name}" 
                                                       FontSize="16" 
                                                       FontAttributes="Bold" />
                                                <Label Text="{Binding BodyLocation}" 
                                                       FontSize="14" 
                                                       TextColor="{StaticResource Gray600}" />
                                                <Label Text="{Binding DateCreated, StringFormat='Created: {0:MMM dd, yyyy}'}" 
                                                       FontSize="12" 
                                                       TextColor="{StaticResource Gray600}" />
                                            </StackLayout>
                                            
                                            <!-- Status Indicator -->
                                            <Frame Grid.Column="2" 
                                                   BackgroundColor="{StaticResource Success}"
                                                   CornerRadius="10" 
                                                   Padding="8,4" 
                                                   VerticalOptions="Center">
                                                <Label Text="{Binding Type}" 
                                                       FontSize="12" 
                                                       TextColor="White" />
                                            </Frame>
                                        </Grid>
                                    </DataTemplate>
                                </CollectionView.ItemTemplate>
                            </CollectionView>
                        </StackLayout>
                    </Frame>
                    
                    <!-- All Wounds Section -->
                    <Frame BackgroundColor="{AppThemeBinding Light=White, Dark={StaticResource Gray900}}"
                           HasShadow="True" CornerRadius="10" Padding="15">
                        <StackLayout>
                            <Label Text="All Wounds" 
                                   FontSize="18" FontAttributes="Bold" 
                                   TextColor="{AppThemeBinding Light={StaticResource Gray900}, Dark=White}" />
                            
                            <CollectionView ItemsSource="{Binding Wounds}"
                                          EmptyView="No wounds recorded">
                                <CollectionView.ItemTemplate>
                                    <DataTemplate>
                                        <Grid Padding="10" x:DataType="models:Wound">
                                            <Grid.GestureRecognizers>
                                                <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:WoundListViewModel}}, Path=SelectWoundCommand}"
                                                                    CommandParameter="{Binding .}" />
                                            </Grid.GestureRecognizers>
                                            
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="40" />
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="Auto" />
                                            </Grid.ColumnDefinitions>
                                            
                                            <!-- Status Dot -->
                                            <Ellipse Grid.Column="0"
                                                     Fill="{StaticResource Success}"
                                                   WidthRequest="12" 
                                                   HeightRequest="12" 
                                                   VerticalOptions="Center" />
                                            
                                            <!-- Wound Info -->
                                            <StackLayout Grid.Column="1" 
                                                       VerticalOptions="Center" 
                                                       Margin="10,0,0,0">
                                                <Label Text="{Binding Name}" 
                                                       FontSize="14" />
                                                <Label Text="{Binding BodyLocation}" 
                                                       FontSize="12" 
                                                       TextColor="{StaticResource Gray600}" />
                                            </StackLayout>
                                            
                                            <!-- Date -->
                                            <Label Grid.Column="2" 
                                                   Text="{Binding DateCreated, StringFormat='{0:MMM dd}'}" 
                                                   FontSize="12" 
                                                   TextColor="{StaticResource Gray600}"
                                                   VerticalOptions="Center" />
                                        </Grid>
                                    </DataTemplate>
                                </CollectionView.ItemTemplate>
                            </CollectionView>
                        </StackLayout>
                    </Frame>
                    
                </StackLayout>
            </ScrollView>
        </RefreshView>

        <!-- Loading Indicator -->
        <ActivityIndicator Grid.Row="1" 
                         IsVisible="{Binding IsBusy}" 
                         IsRunning="{Binding IsBusy}"
                         VerticalOptions="Center"
                         HorizontalOptions="Center"
                         Color="{StaticResource Primary}" />

        <!-- Bottom Navigation/Action Bar -->
        <Frame Grid.Row="2" BackgroundColor="{AppThemeBinding Light={StaticResource Gray100}, Dark={StaticResource Gray800}}" 
               HasShadow="True" CornerRadius="0" Padding="20,10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                
                <Button Grid.Column="0" 
                        Text="Home" 
                        BackgroundColor="Transparent"
                        TextColor="{StaticResource Primary}"
                        FontSize="12" />
                        
                <Button Grid.Column="1" 
                        Text="Camera" 
                        Command="{Binding AddWoundCommand}"
                        BackgroundColor="{StaticResource Primary}"
                        TextColor="White"
                        CornerRadius="20"
                        FontSize="12" />
                        
                <Button Grid.Column="2" 
                        Text="Analysis" 
                        BackgroundColor="Transparent"
                        TextColor="{StaticResource Primary}"
                        FontSize="12" />
            </Grid>
        </Frame>
    </Grid>
</ContentPage>